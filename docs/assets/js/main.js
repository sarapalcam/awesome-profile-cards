"use strict";const legendShare=document.querySelector(".js_legendShare"),legendFill=document.querySelector(".js_legendFill"),legendDesign=document.querySelector(".js_legendDesign"),fr=new FileReader,fileField=document.querySelector(".js__profile-upload-btn"),profileImage=document.querySelector(".js__profile-image"),profilePreview=document.querySelector(".js__profile-preview"),namePreview=document.querySelector(".js-preview__name"),jobPreview=document.querySelector(".js-preview__job"),phonePreview=document.querySelector(".js-preview__phone"),mailPreview=document.querySelector(".js-preview__mail"),linkedinPreview=document.querySelector(".js-preview__linkedin"),githubPreview=document.querySelector(".js-preview__github"),allInputs=document.querySelectorAll(".input"),shareBtn=document.querySelector(".js_shareBtn"),palette=document.querySelectorAll(".js-radio"),preview=document.querySelector(".preview__article"),data={name:"",job:"",photo:"",email:"",phone:"",linkedin:"",github:"",palette:""};let savedName={};const generatedLink=document.querySelector(".js_share_link"),twitterBtn=document.querySelector(".js-twitter"),shareResult=document.querySelector(".share__result"),resetBtn=document.querySelector(".js-resetBtn");function rotateArrowDesign(){!1===legendDesign.parentNode.classList.contains("collapse")?legendDesign.parentNode.classList.add("rotateArrow"):legendDesign.parentNode.classList.remove("rotateArrow")}function rotateArrowFill(){!1===legendFill.parentNode.classList.contains("collapse")?legendFill.parentNode.classList.add("rotateArrow"):legendFill.parentNode.classList.remove("rotateArrow")}function rotateArrowShare(){!1===legendShare.parentNode.classList.contains("collapse")?legendShare.parentNode.classList.add("rotateArrow"):legendShare.parentNode.classList.remove("rotateArrow")}function rotateArrow(e){e.currentTarget.parentNode.classList.toggle("rotateArrow"),e.currentTarget===legendShare?(rotateArrowDesign(),rotateArrowFill()):e.currentTarget===legendFill?(rotateArrowShare(),rotateArrowDesign()):(rotateArrowFill(),rotateArrowShare())}function collapseContent(e){e.currentTarget.parentNode.classList.toggle("collapse"),e.currentTarget===legendShare?(legendFill.parentNode.classList.add("collapse"),legendDesign.parentNode.classList.add("collapse")):e.currentTarget===legendFill?(legendShare.parentNode.classList.add("collapse"),legendDesign.parentNode.classList.add("collapse")):(legendShare.parentNode.classList.add("collapse"),legendFill.parentNode.classList.add("collapse"))}function handlerClickLegend(e){collapseContent(e),rotateArrow(e)}function getImage(e){const r=e.currentTarget.files[0];fr.addEventListener("load",writeImage),fr.readAsDataURL(r)}function writeImage(){profileImage.style.backgroundImage=`url(${fr.result})`,profilePreview.style.backgroundImage=`url(${fr.result})`,data.photo=fr.result,localStorage.setItem("userData",JSON.stringify(data))}function fakeFileClick(){fileField.click()}function handleWriteInput(e){const r=e.currentTarget.name,t=e.currentTarget.value;data[r]=t,localStorage.setItem("userData",JSON.stringify(data)),checkCompletedData()}function getPaletteColour(e){const r=savedName[e];for(let e=1;e<=3;e++)r===""+e&&(preview.classList.add("palette-"+e),data.palette=""+e);document.querySelector(".js-palette-"+r).checked=!0,checkCompletedData()}function renderPreview(){namePreview.innerHTML=data.name,jobPreview.innerHTML=data.job,phonePreview.href=data.phone,mailPreview.href=data.email,linkedinPreview.href=data.linkedin,githubPreview.href=data.github}function getStoredData(){savedName=JSON.parse(localStorage.getItem("userData"));for(const e in savedName)if(savedName[e])if(data[e]=savedName[e],"photo"===e)profileImage.style.backgroundImage=`url(${savedName[e]})`,profilePreview.style.backgroundImage=`url(${savedName[e]})`;else if("palette"===e)getPaletteColour(e);else{document.querySelector("#"+e).value=savedName[e],renderPreview()}}function renderUserValue(){""===data.name?namePreview.innerHTML="Nombre Apellido":namePreview.innerHTML=data.name,""===data.job?jobPreview.innerHTML="Front-end developer":jobPreview.innerHTML=data.job,mailPreview.href="mailto:"+data.email,phonePreview.href="tel:"+data.phone,linkedinPreview.href="https://www.linkedin.com/in/"+data.linkedin,githubPreview.href="https://github.com/"+data.github}function handlePaletteClick(e){const r=e.currentTarget.value;"1"===r?(preview.classList.add("palette-1"),preview.classList.remove("palette-2"),preview.classList.remove("palette-3"),data.palette="1"):"2"===r?(preview.classList.add("palette-2"),preview.classList.remove("palette-1"),preview.classList.remove("palette-3"),data.palette="2"):"3"===r&&(preview.classList.add("palette-3"),preview.classList.remove("palette-1"),preview.classList.remove("palette-2"),data.palette="3")}legendShare.addEventListener("click",handlerClickLegend),legendFill.addEventListener("click",handlerClickLegend),legendDesign.addEventListener("click",handlerClickLegend),fileField.addEventListener("change",getImage),null!==localStorage.getItem("userData")&&getStoredData();for(const e of palette)e.addEventListener("click",handlePaletteClick);function handleUserInput(e){handleWriteInput(e),renderUserValue()}for(const e of allInputs)e.addEventListener("keyup",handleUserInput),e.addEventListener("click",handleUserInput);function removeCollapse(){shareResult.classList.remove("collapseShare"),shareResult.classList.remove("hidden")}function shareCard(){removeCollapse(),disableBtnCreate(shareBtn)}function handleClickCreate(e){e.preventDefault(),shareCard(),fetch("https://awesome-profile-cards.herokuapp.com/card",{method:"POST",body:JSON.stringify(data),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.success&&(generatedLink.innerHTML=e.cardURL,generatedLink.href=e.cardURL,twitterBtn.href="https://twitter.com/intent/tweet?text=Esta es mi tarjeta de Awesome Cards&url="+e.cardURL)}).catch(e=>console.error(e))}function enableBtnCrate(e){e.classList.remove("share__create_btn--off"),e.classList.add("share__create_btn--on"),e.disabled=!1,e.addEventListener("click",handleClickCreate)}function disableBtnCreate(e){e.classList.add("share__create_btn--off"),e.classList.remove("share__create_btn--on"),e.disabled=!0}function checkCompletedData(){""!==data.name&&""!==data.job&&""!==data.photo&&""!==data.email&&""!==data.linkedin&&""!==data.github&&""!==data.palette&&enableBtnCrate(shareBtn)}function clearDataObject(){data.name="",data.job="",data.photo="",data.email="",data.phone="",data.linkedin="",data.github="",data.palette=""}function resetInputValues(){for(const e of allInputs)"palette"===e.name?e.checked=!1:e.value=""}function resetPreviewCard(){phonePreview.href="",mailPreview.href="",linkedinPreview.href="",githubPreview.href="",profileImage.style.backgroundImage="",profilePreview.style.backgroundImage="",generatedLink.innerHTML="",generatedLink.href="",preview.classList.remove("palette-2"),preview.classList.remove("palette-3"),preview.classList.add("palette-1")}function collapseFillAndShare(){legendDesign.parentNode.classList.remove("collapse"),legendFill.parentNode.classList.add("collapse"),legendFill.parentNode.classList.remove("rotateArrow"),legendShare.parentNode.classList.add("collapse"),legendShare.parentNode.classList.remove("rotateArrow")}function resetForm(e){e.preventDefault(),localStorage.clear("userData"),shareResult.classList.add("hidden"),disableBtnCreate(shareBtn),clearDataObject(),renderUserValue(),resetInputValues(),resetPreviewCard(),collapseFillAndShare()}resetBtn.addEventListener("click",resetForm);let regExMail=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,regExPhone=/^[^a-zA-Z]+$/;const errorMessage={palette:"Tienes que seleccionar una paleta de colores para crear tu tarjeta",empty:"Tienes que completar todos los campos obligatorios para crear tu tarjeta",email:"Por favor, introduce una dirección de email válida. Ej.: maripuri@lamaster.com",phone:"Por favor, introduce un número de teléfono válido. Ej.: 611661234",linkedin:"Por favor, introduce un usuario de Linkedin válido, no deben incluirse links a la página. Ej.: lamari.master",github:"Por favor, introduce un usuario de gitHub válido, no deben incluirse links a la página. Ej.: lamari"};function createError(e,r){const t=document.createElement("p");t.classList.add("js-error-"+r),t.classList.add("js-error"),t.classList.add("error__"+r),t.id=r;const a=document.createElement("div");a.classList.add(`error__${r}--decoration`);let l=document.createTextNode(e);return t.appendChild(a),t.appendChild(l),t}function createErrorPalette(){if(""===data.palette){removeError(".js-error-palette");const e=createError(errorMessage.palette,"palette");legendDesign.appendChild(e),blockCollapsePallete(),blockArrowsSharePalette()}}function blockCollapsePallete(){legendShare.parentNode.classList.add("collapse"),legendDesign.parentNode.classList.remove("collapse")}function blockArrowsSharePalette(){legendShare.parentNode.classList.contains("collapse")&&legendShare.parentNode.classList.remove("rotateArrow"),!1===legendDesign.parentNode.classList.contains("collapse")&&legendDesign.parentNode.classList.add("rotateArrow")}function createErrorEmptyFill(){""!==data.name&&""!==data.job&&""!==data.photo&&""!==data.email&&""!==data.linkedin&&""!==data.github||(removeEmptyError(),createErrorFill(errorMessage.empty,"empty"))}function blockCollapseFill(){legendShare.parentNode.classList.add("collapse"),legendFill.parentNode.classList.remove("collapse")}function blockArrowsShareFill(){legendShare.parentNode.classList.contains("collapse")&&legendShare.parentNode.classList.remove("rotateArrow"),!1===legendFill.parentNode.classList.contains("collapse")&&legendFill.parentNode.classList.add("rotateArrow")}function createErrorFill(e,r){const t=createError(e,r);legendFill.appendChild(t),blockCollapseFill(),blockArrowsShareFill()}function createErrorEmail(){if(""!==data.email&&!1===regExMail.test(data.email)){removeError(".js-error-email");const e=createError(errorMessage.email,"email");legendFill.appendChild(e),blockCollapseFill(),blockArrowsShareFill()}}function createErrorPhone(){if(""!==data.phone&&!1===regExPhone.test(data.phone)){removeError(".js-error-phone");const e=createError(errorMessage.phone,"phone");legendFill.appendChild(e),blockCollapseFill(),blockArrowsShareFill()}}function createErrorLinkedin(){if(0===data.linkedin.indexOf("http://")||0===data.linkedin.indexOf("https://")){removeError(".js-error-linkedin");const e=createError(errorMessage.linkedin,"linkedin");legendFill.appendChild(e),blockCollapseFill(),blockArrowsShareFill()}}function createErrorGithub(){if(0===data.github.indexOf("http://")||0===data.github.indexOf("https://")){removeError(".js-error-github");const e=createError(errorMessage.github,"github");legendFill.appendChild(e),blockCollapseFill(),blockArrowsShareFill()}}function findFormErrors(){createErrorPalette(),createErrorEmptyFill(),createErrorEmail(),createErrorPhone(),createErrorLinkedin(),createErrorGithub()}function removeError(e){const r=document.querySelectorAll(e);for(const e of r)e.remove()}function removeEmptyError(){removeError(".js-error-empty")}function removeAllErrors(){const e=document.querySelectorAll(".js-error");for(const r of e)r.remove()}function handleClickShare(){findFormErrors()}function handleClickInput(e){removeAllErrors(),e.currentTarget.parentNode.classList.contains("color")?(legendDesign.parentNode.classList.remove("collapse"),legendFill.parentNode.classList.add("collapse")):e.currentTarget.parentNode.classList.contains("form")&&(legendDesign.parentNode.classList.add("collapse"),legendFill.parentNode.classList.remove("collapse"))}function handleClickReset(){removeAllErrors()}legendShare.addEventListener("click",handleClickShare),resetBtn.addEventListener("click",handleClickReset);for(const e of allInputs)e.addEventListener("click",handleClickInput);